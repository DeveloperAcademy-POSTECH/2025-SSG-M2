## **🧠 Swift에서의 비동기 통신 (Asynchronous Communication)**

### **✅ 동기(Synchronous) vs 비동기(Asynchronous)**

|**동기(Synchronous)**|**비동기(Asynchronous)**|
|---|---|
|요청 후 응답이 올 때까지 기다림|요청 후 기다리지 않고 다른 작업 수행|
|예: 음식 주문하고 조리 끝날 때까지 줄서기|예: 음식 주문하고 진동벨 받고 자리에 앉기|

### **✅ Swift에서 비동기 통신이 필요한 이유**

- 서버 요청, 이미지 다운로드, 파일 저장 등은 시간이 걸림
- **동기 방식**으로 처리하면 앱이 멈춘 듯 보일 수 있음 (UI 프리징)
- **비동기 처리**를 통해 사용자 경험을 부드럽게 만들 수 있음

### **✅ 가장 흔한 비동기 예: URLSession**

```swift
// 서버에서 뉴스 기사 데이터를 받아오는 함수 정의
func fetchArticles() {
    
    // 뉴스 API 주소를 URL 타입으로 변환
    // URL(string:)은 옵셔널을 반환하므로 보통은 안전하게 처리해야 하지만, 여기서는 !로 강제 언래핑
    let url = URL(string: "<https://newsapi.org/articles>")!
    
    // URLSession을 이용해 비동기 네트워크 요청을 생성
    // dataTask는 서버에 GET 요청을 보내고, 응답이 오면 클로저를 실행함
    URLSession.shared.dataTask(with: url) { data, response, error in
        
        // 서버 응답이 성공적으로 도착했을 때 data가 존재하면 실행
        if let data = data {
            // 받은 데이터를 콘솔에 출력 (보통은 JSON 디코딩 등을 수행)
            print("서버 응답 데이터:", data)
        }
        
        // error가 있거나 data가 nil인 경우는 별도로 처리하지 않음
        // 실제 앱에서는 에러 처리 로직이 필요함
        
    }.resume() // 이걸 호출해야 요청이 실제로 시작됨
}
```

- dataTask는 **비동기적으로 동작**
- 요청 후 응답을 기다리는 동안 앱은 계속 작동함
- 응답이 오면 클로저(콜백) 내부 코드가 실행됨

### **🧰 Swift에서 비동기 처리 방식 3가지**

|**방식**|**설명**|
|---|---|
|**1. Completion Handler (클로저)**|콜백 함수 형태. URLSession 등 전통적인 방식|
|**2. async / await**|Swift 5.5부터 도입된 최신 방식. 코드가 간결하고 읽기 쉬움|
|**3. Combine / RxSwift**|반응형 프로그래밍 방식. 스트림 기반 처리에 적합|

### **✨ async / await 사용 예시**

```swift
// 데이터를 비동기적으로 받아오는 함수 정의
// async: 이 함수는 비동기 작업을 포함함 (await로 호출해야 함)
func fetchData() async {
    
    do {
        // URLSession을 사용하여 GET 요청을 보냄
        // try: 요청이 실패할 수 있기 때문에 오류 처리 필요
        // await: 서버의 응답을 기다림 (비동기지만 흐름은 동기처럼 표현됨)
        // (data, _): 응답 결과는 튜플 형태 → data는 서버 응답 데이터, _는 URLResponse (여기선 사용하지 않음)
        // data는 택배 상자 안의 내용물,
				// URLResponse는 택배 상자에 붙은 송장 (언제 왔는지, 어디서 왔는지 등 정보)
        let (data, _) = try await URLSession.shared.data(from: URL(string: "<https://example.com>")!)
        
        // 성공적으로 데이터를 받아오면 콘솔에 출력
        print("서버 응답:", data)
        
    } catch {
        // 네트워크 오류 발생 시 catch 블록 실행
        // 예: 인터넷 끊김, URL 문제, 서버 응답 없음 등
        print("에러 발생:", error)
    }
}
```

- await: 응답을 기다리되 메인 스레드는 막지 않음
- async: 이 함수는 비동기 작업임을 나타냄
- → **비동기 코드임에도 동기처럼 읽히는 장점**

---

### **🧪 실전 예제: 서버에서 JSON 데이터 받아오기 (async/await)**

### **✅ 1. 데이터 모델 정의**

```swift
// 서버에서 받아올 JSON 구조와 매칭되는 모델
struct Article: Decodable {
    let id: Int
    let title: String
    let content: String
}
```

### **✅ 2. 네트워크 통신 함수 정의**

```swift
func fetchArticles() async throws -> [Article] {
    let url = URL(string: "<https://example.com/articles>")!
    let (data, _) = try await URLSession.shared.data(from: url)
    
    let articles = try JSONDecoder().decode([Article].self, from: data)
    return articles
}
```

- try await을 통해 **응답을 기다리되 앱은 멈추지 않음**
- 응답 데이터를 JSONDecoder로 디코딩하여 [Article] 배열로 반환

### **✅ 3. SwiftUI에서 사용하기 (뷰 코드)**

```swift
import SwiftUI

struct ArticleListView: View {
    @State private var articles: [Article] = []
    
    var body: some View {
        List(articles, id: \\.id) { article in
            VStack(alignment: .leading) {
                Text(article.title)
                    .font(.headline)
                Text(article.content)
                    .font(.subheadline)
            }
        }
        .task {
            do {
                articles = try await fetchArticles()
            } catch {
                print("데이터 로드 실패:", error)
            }
        }
    }
}
```

- .task를 사용하면 뷰가 나타날 때 fetchArticles()가 비동기로 실행됨
- 데이터를 가져와서 articles 상태 변수에 저장 → 리스트로 표시

### **📌 참고: 서버 JSON 형태 예시**

```swift
[
  {
    "id": 1,
    "title": "Swift 비동기 통신이란?",
    "content": "async/await을 통해 데이터를 받아올 수 있습니다."
  },
  {
    "id": 2,
    "title": "SwiftUI와 네트워크 연동",
    "content": "List, State, Task 등을 함께 사용합니다."
  }
]
```

### **✅ 마무리 요약**

- async/await을 쓰면 비동기 네트워크 코드가 훨씬 깔끔하고 오류 처리도 명확해짐

### **🧩 요약 정리**

| **항목**     | **설명**                        |
| ---------- | ----------------------------- |
| **비동기란?**  | 오래 걸리는 작업이 앱을 멈추지 않게 처리하는 방식  |
| **왜 필요해?** | 네트워크 지연, 대용량 처리 등에서 사용자 경험 보호 |
| **사용 예시**  | 서버 통신, 이미지 다운로드, 파일 I/O       |
| **핵심 문법**  | URLSession, async/await       |
